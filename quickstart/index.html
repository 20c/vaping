<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://github.com/20c/vaping/quickstart/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Quick Start Examples - Vaping</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Quick Start Examples";
        var mkdocs_page_input_path = "quickstart.md";
        var mkdocs_page_url = "/20c/vaping/quickstart/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Vaping
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Quick Start Examples</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#install-fping">Install fping</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../examples/">Advanced Examples</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../layout/">Customize Layout</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../config/">Configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../dev/">Development</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../api/vaping/">vaping</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/vaping.cli/">vaping.cli</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/vaping.config/">vaping.config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/vaping.daemon/">vaping.daemon</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/vaping.io/">vaping.io</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/vaping.plugins/">vaping.plugins</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/vaping.plugins.command/">vaping.plugins.command</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/vaping.plugins.fping/">vaping.plugins.fping</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/vaping.plugins.fping_mtr/">vaping.plugins.fping_mtr</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/vaping.plugins.logparse/">vaping.plugins.logparse</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/vaping.plugins.rrd/">vaping.plugins.rrd</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/vaping.plugins.vodka/">vaping.plugins.vodka</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/vaping.plugins.whisper/">vaping.plugins.whisper</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/vaping.plugins.zeromq/">vaping.plugins.zeromq</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Vaping</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Quick Start Examples</li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://github.com/20c/vaping/edit/master/docs/quickstart.md"
          class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="install-vaping">Install vaping</h2>
<p>You always need to install vaping with:</p>
<pre><code class="language-sh">pip install vaping
</code></pre>
<div class="admonition tip">
<p class="admonition-title">Error due to outdated setuptools</p>
<p>You may get an error when trying to install:</p>
<p>error in vaping setup command: 'install_requires' must be a string or list of strings containing valid project/version requirement specifiers; Expected ',' or end-of-list in whichcraft==0.4.0 ; python_version&lt;'3.3' at  ; python_version&lt;'3.3'</p>
<p>This means you need to update your setuptools, you can do so by running</p>
<p><code>pip install setuptools -U</code></p>
</div>
<h3 id="install-fping">Install fping</h3>
<p>Most examples require <code>fping</code> to be installed.</p>
<p>To install for CentOS or RHEL, you can get the package from EPEL:</p>
<pre><code class="language-sh">yum install epel-release
yum install fping
</code></pre>
<p>To install for Debian Or Ubuntu:</p>
<pre><code class="language-sh">sudo apt-get install fping
</code></pre>
<h2 id="example-standalone-latency">Example Standalone Latency</h2>
<p>The example config file (from <code>examples/standalone_dns</code>) uses both vodka and graphsrv plugins, so those will need to be installed with:</p>
<pre><code class="language-sh">pip install -U vodka
pip install -U graphsrv
</code></pre>
<div class="admonition tip">
<p class="admonition-title">You can still use old graphsrv</p>
<p>We have recently added a major upgrade to graphsrv by switching to a d3.js based frontend.</p>
<p>While this upgrade should be seamless on your end, if you still want to use the old graphsrv for now you can do so by pinning the version to 1.2.0</p>
<p><code>pip install graphsrv==1.2.0</code></p>
</div>
<p>Clone the github repository to have access to the example configuration files:</p>
<pre><code class="language-sh">git clone git@github.com:20c/vaping.git
cd vaping
</code></pre>
<p>Then just start vaping with:</p>
<pre><code class="language-sh">vaping start --home=examples/standalone_dns/ --debug
</code></pre>
<p>By default it uses a generic layout template and listens on http://0.0.0.0:7021 - going to that in a browser should produce the summary paging which looks like:</p>
<p><img alt="Vaping" src="https://raw.githubusercontent.com/20c/vaping/master/docs/img/standalone_dns.png" /></p>
<p>And clicking on the title will navigate to a detail page which looks like:</p>
<p><img alt="Vaping" src="https://raw.githubusercontent.com/20c/vaping/master/docs/img/standalone_dns-detail.png" /></p>
<p>Below is the config file, common things to change include:</p>
<ul>
<li>hosts: probes.public_dns.hosts</li>
<li>listening address: plugins.vodka.plugins.http.host and port</li>
<li>fping frequency: plugins.std_fping.count and interval</li>
</ul>
<p>Config file:</p>
<p><code>examples/standalone_dns/config.yml</code>:</p>
<pre><code class="language-yml">probes:
  - name: latency
    type: std_fping
    output:
      - vodka

    groups:
      - name: public_dns
        hosts:
          - host: 8.8.8.8
            name: Google
            color: red
          - host: 4.2.2.1
            name: Level(3)
            color: blue
          - host: 208.67.222.222
            name: OpenDNS
            color: orange

plugins:
  - name: std_fping
    type: fping
    count: 10
    interval: 3s
    output:
      - vodka

  - name: vodka
    type: vodka

    data:
      - type: fping
        handlers:
          - type: index
            index: host
          - type: store
            container: list
            limit: 500

    apps:
      graphsrv:
        enabled: true
        graphs:
          multitarget:
            id_field: host
            type: multitarget
            plot_y: avg
            format_y: ms

          smokestack:
            id_field: host
            type: smokestack
            plot_y: avg

    plugins:

      - name: http
        type: flask
        bind: 0.0.0.0:7021
        debug: true
        static_url_path: /static
        server: self
        async: thread
        routes:
          /targets : graphsrv-&gt;targets
          /graph_data :
            methods:
              - POST
              - GET
            target: graphsrv-&gt;graph_data
          /graph : graphsrv-&gt;graph_view
          /overview_read_file : graphsrv-&gt;overview_read_file
          /: graphsrv-&gt;overview_view


logging:
  version: 1
  formatters:
    simple:
      format: '%(asctime)s - %(name)s - %(levelname)s: %(message)s'
  handlers:
    console:
      class: logging.StreamHandler
      level: DEBUG
      formatter: simple
      stream: ext://sys.stdout

    #file:
    #  class: logging.FileHandler
    #  level: DEBUG
    #  formatter: simple
    #  filename: /home/dev/sandbox/vaping/vaping.log

  loggers:
    vaping:
      level: DEBUG
      handlers:
        - console
        #- file
    vodka:
      level: DEBUG
      handlers:
        - console
        #- file

</code></pre>
<h2 id="example-distributed-latency">Example Distributed Latency</h2>
<p>The example config file (from <code>examples/distributed_dns</code>) is the same as the standalone one and uses both vodka and graphsrv, so those need to be installed with:</p>
<pre><code class="language-sh">pip install -U vodka
pip install -U graphsrv
</code></pre>
<p>Also if you are using <code>zmq</code> to send data between the processes (the default) you will need to install the pyzmq and zmq:</p>
<pre><code class="language-sh">pip install &quot;pyzmq&lt;20&quot;
</code></pre>
<p>In some instances you may also be required to install the zmq module alongside it.
If you are getting startup issues try adding the following as well:</p>
<pre><code class="language-sh">pip install zmq
</code></pre>
<p>The main difference is the collector is running in a separate process than the
web server, which allows you to graph things from multiple locations, as well
as using another webserver, such as nginx to serve client requests.</p>
<p>To try it out, start vaping with:</p>
<pre><code class="language-sh">vaping start --home=examples/distributed_dns/vaping/ --debug
</code></pre>
<div class="admonition tip">
<p class="admonition-title">Standalone vs Distributed Configs</p>
<p>The example config files between standalone and distribtuted setups are not compatible. Running a distributed setup requires running vaping instance(s) and the web server like Gunicorn or UWSGI to present the web elements.</p>
</div>
<h3 id="gunicorn">Gunicorn</h3>
<p>To test with gunicorn, first install it:</p>
<pre><code class="language-sh">pip install gunicorn
</code></pre>
<p>plugins['http'].server is already set to 'gunicorn' in
<code>examples/distributed_dns/vodka/config.yml</code> so run:</p>
<pre><code class="language-sh">export VODKA_HOME=examples/distributed_dns/vodka
gunicorn -b 0.0.0.0:7021 vodka.runners.wsgi:application
</code></pre>
<p>You should be able to browse to port 7021 to see the display.</p>
<h4 id="gunicorn-fails-to-start">Gunicorn fails to start</h4>
<p>If gunicorn fails to start and doesn't tell you why, it's probably some missing
dependency. You can force it to output what it is failing on by passing the
<code>--preload</code> argument to the <code>gunicorn</code> command.</p>
<h3 id="nginx">nginx</h3>
<p>To test with nginx, install uwsgi:</p>
<pre><code class="language-sh">pip install uwsgi
</code></pre>
<p>In <code>examples/distributed_dns/vodka/config.yml</code> change plugins['http'].server
to 'uwsgi' and then configure nginx with an upstream to connect to it.</p>
<p><code>nginx.conf</code>:</p>
<pre><code>upstream vaping {
    server 127.0.0.1:7021;
}

server {
        location / {
          uwsgi_pass vaping;
          include uwsgi_params;
        }
}
</code></pre>
<p>Start the uwsgi process with:</p>
<pre><code class="language-sh">export VODKA_HOME=examples/distributed_dns/vodka
uwsgi -H $VIRTUAL_ENV --socket=0.0.0.0:7026 -w vodka.runners.wsgi:application --enable-threads
</code></pre>
<p>You should be able to point your browser to the address nginx is listening
on to view it.</p>
<div class="admonition tip">
<p class="admonition-title">Note</p>
<p>If you're running selinux, you'll need to allow nginx to connect to it
with <code>setsebool -P httpd_can_network_connect 1</code>.</p>
</div>
<p>Config files:</p>
<p><code>examples/distributed_dns/vaping/config.yml</code>:</p>
<pre><code class="language-yml">probes:
  - name: latency
    type: std_fping
    output:
      - zmq_vodka

    groups:
      - name: public_dns
        hosts:
          - host: 8.8.8.8
            name: Google
            color: red
          - host: 4.2.2.1
            name: Level(3)
            color: blue
          - host: 208.67.222.222
            name: OpenDNS
            color: orange

plugins:
  - name: std_fping
    type: fping
    count: 10
    interval: 3s

  - name: zmq_vodka
    type: zeromq
    bind: tcp://127.0.0.1:6021



logging:
  version: 1
  formatters:
    simple:
      format: '%(asctime)s - %(name)s - %(levelname)s: %(message)s'
  handlers:
    console:
      class: logging.StreamHandler
      level: DEBUG
      formatter: simple
      stream: ext://sys.stdout

    #file:
    #  class: logging.FileHandler
    #  level: DEBUG
    #  formatter: simple
    #  filename: /home/dev/sandbox/vaping/vaping.log

  loggers:
    vaping:
      level: DEBUG
      handlers:
        - console
        #- file
</code></pre>
<p><code>examples/distributed_dns/vodka/config.yml</code>:</p>
<pre><code class="language-yml">data:
  - type: fping
    handlers:
      - type: index
        index: host
      - type: store
        container: list
        limit: 500

apps:
  graphsrv:
    enabled: true

    # here is where we define host config
    groups:
      latency:
        public_dns:
          8.8.8.8:
            name: Google DNS
            color: red
          4.2.2.1:
            name: Level(3)
            color: blue
          208.67.222.222:
            name: OpenDNS
            color: orange

    graphs:
      multitarget:
        id_field: host
        type: multitarget
        plot_y: avg
        format_y: ms

      smokestack:
        id_field: host
        type: smokestack
        plot_y: avg

plugins:

  # zero mq probe plugin (latency name is important, so it can be
  # routed properly to the similarly named group)
  - name: latency
    type: zeromq_probe
    data: fping
    interval: 1.0
    bind: tcp://127.0.0.1:6021
    async: thread

  - name: http
    type: flask
    bind: 0.0.0.0:7021
    debug: true
    # set this to gunicorn or uwsgi depending on what you want to run with
    server: gunicorn
    async: gevent
    routes:
      /targets : graphsrv-&gt;targets
      /graph_data :
        methods:
          - POST
          - GET
        target: graphsrv-&gt;graph_data
      /graph : graphsrv-&gt;graph_view
      /overview_read_file : graphsrv-&gt;overview_read_file
      /: graphsrv-&gt;overview_view


logging:
  version: 1
  formatters:
    simple:
      format: '%(asctime)s - %(name)s - %(levelname)s: %(message)s'
  handlers:
    console:
      class: logging.StreamHandler
      level: DEBUG
      formatter: simple
      stream: ext://sys.stdout
  loggers:
    vodka:
      level: DEBUG
      handlers:
        - console
</code></pre>
<h2 id="deep-dive-into-the-distributed-example">Deep dive into the distributed example</h2>
<p>Looking at <a href="https://github.com/20c/vaping/tree/master/examples/distributed_dns">https://github.com/20c/vaping/tree/master/examples/distributed_dns</a></p>
<p>There are two directories in there, one called <code>vodka</code> and one called <code>vaping</code></p>
<p><code>vodka</code> is the config that is used by the vodka web service (so this would be your web server)
<code>vaping</code> is the config that is used by a vaping process that runs and fping and send the data to <code>vodka</code></p>
<p>While the standalone variation of vaping can run vodka as a plugin, in this case both are meant to
be run in separate processes and can be on separate hosts.</p>
<p>Using the example: to start the web server on one host (using gunicorn to run it):</p>
<pre><code>export VODKA_HOME=examples/distributed_dns/vodka
gunicorn -b 0.0.0.0:7021 vodka.runners.wsgi:application
</code></pre>
<p>Then start the vaping that runs fping on a different host:</p>
<pre><code>vaping start --home=examples/distributed_dns/vaping/ --debug
</code></pre>
<h2 id="configuring-zmq-and-groups">Configuring zmq and groups</h2>
<h3 id="vodka-web-server">Vodka (web server)</h3>
<p>In the vodka config, each zeromq connection is instantiated by the <code>zeromq_probe</code> plugin, so it needs one of those for each vaping sending data. Please be aware of <a href="https://github.com/20c/vodka/issues/11">https://github.com/20c/vodka/issues/11</a> because it's a bit counterintuitive.</p>
<pre><code>plugins:
  ...
  # zero mq probe plugin (latency name is important, so it can be
  # routed properly to the similarly named group)
  - name: latency
    type: zeromq_probe
    data: fping
    interval: 1.0
    bind: tcp://127.0.0.1:6021
    async: thread
</code></pre>
<p>Additionally, vodka will need to be made aware of any data group that will be sent to it, so each new vaping process will need a new group added in <code>apps.graphsrv.groups</code></p>
<pre><code>apps:
  graphsrv:
    groups:
      # same name as zeromq_probe instance name above (important!)
      latency:
        public_dns:
          8.8.8.8:
            name: Google DNS
            color: red
          4.2.2.1:
            name: Level(3)
            color: blue
          208.67.222.222:
            name: OpenDNS
            color: orange
</code></pre>
<h3 id="vaping">Vaping</h3>
<p>Likewise, in the vaping config you will need to configure the zmq connection via the <code>zeromq</code> plugin:</p>
<pre><code>plugins:
  ...
  - name: zmq_vodka
    type: zeromq
    bind: tcp://127.0.0.1:6021
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href=".." class="btn btn-neutral float-left" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../examples/" class="btn btn-neutral float-right" title="Advanced Examples">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/20c/vaping" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../examples/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
